---
title: "Take-home Exercise 1"
subtitle: "[Take-home Exercise 1](https://isss608-ay2023-24jan.netlify.app/take-home_ex/th_ex01)" 
author: "Victoria Neo"
date: 01/21/2024
date-modified: 01/21/2024
format:
  html:
    code-fold: true
    code-summary: "code block"
    code-tools: true
    code-copy: true
---

![](images/clipboard-2705904821.png){width="60%" height="60%"}

Meritocracy cartoon, October 29, 2010 (Josh C. Lyman via <http://www.clibsy.com/>). *Taken from* [Merit-hypocrisy in the Air](https://donaldearlcollins.com/2015/04/18/merit-hypocrisy-in-the-air/)

# 1 Setting the scene

OECD education director Andreas Schleicher shared in a BBC article that “Singapore managed to achieve excellence without wide differences between children from wealthy and disadvantaged families.” (2016) Furthermore, several Singapore’s Minister for Education also started an “every school a good school” slogan. The general public, however, strongly believes that there are still disparities that exist, especially between the elite schools and neighborhood school, between students from families with higher socioeconomic status and those with relatively lower socioeconomic status and immigration and non-immigration families.

## 1.1 The Task

The 2022 Programme for International Student Assessment (PISA) data was released on December 5, 2022. PISA global education survey every three years to assess the education systems worldwide through testing 15 year old students in the subjects of mathematics, reading, and science.

In this take-home exercise, you are required to use appropriate **Exploratory Data Analysis (EDA)** methods and **ggplot2** functions to reveal:

-   the distribution of Singapore students’ performance in mathematics, reading, and science, and

-   the relationship between these performances with schools, gender and socioeconomic status (SES) of the students.

```{mermaid}
flowchart TB
  A[School] 
  B[SES]
  C[Gender]
  D[Reading Scores]
  E[Math Scores]
  F[Science Scores]
  
  D --> A
  D --> B
  D --> C
  E --> A
  E --> B
  E --> C
  F --> A
  F --> B
  F --> C
```

## 1.2 The Literature Review

> Equity in education means that personal or social circumstances such as gender, socio-economic status, migrant background, age, special needs, or place of residence, do not hinder the achievement of one's educational potential (fairness) \~[OECD Education GPS](https://gpseducation.oecd.org/revieweducationpolicies/#!node=41746&filter=all) (2023)

In **Singapore**, due to our meritocratic system, education and schools are seen as the great equaliser (although talk about equality of opportunities has shifted towards equity of opportunities) to ensure that every child has the same opportunity to academically excel. At the same time, demographic indicators such as Gender and SES also affect academic performance.

::: panel-tabset
### 1.2.1 ***Schools and academic performance***

Minister for Education Chan Chun Sing, in a [2023 MOE speech](https://www.moe.gov.sg/news/speeches/20230301-moe-fy2023-committee-of-supply-debate-response-by-minister-for-education-chan-chun-sing), stated that:

1.  OECD's PISA study found that our students from less advantaged backgrounds not only outperformed their international counterparts of similar socio-economic backgrounds, but they did better than the OECD average in all core domains.

    1.  These students typically have less access to private tuition, and have still managed to do well by international standards.

    2.  This goes to show that our students are industrious, and our education system is doing something right.

    3.  Instead of attributing our students' achievements to the private tuition industry, I think we should give credit to our students, schools, and teachers where credit is due.

[PISA](https://gpseducation.oecd.org/CountryProfile?primaryCountry=SGP&treshold=10&topic=PI) (2022) reported that:

1.  In Singapore, compared to attending a public school, **the difference in mathematics performance associated with attendance at private schools is among the smallest** of the OECD and partner countries/economies, after accounting for students' and schools' socio-economic profile.

This suggests that schools play an equalising role in academic performance, especially for Math (according to PISA). However, there is still an unofficial differentiation of schools into Tier 1, Tier 2 and Tier 3, despite MOE removing school rankings. As argued by the article "[**Is Every School a Good School? Intergenerational Mobility in Singapore, Explained**](https://thekopi.co/2022/03/04/is-every-school-a-good-school/)"(The Kopi, 2022), "differences in funding, programmes and networks means that some schools might provide more opportunities for \[their own\] students than others".

### 1.2.2 ***SES and academic performance***

The imbalance in resources due to the difference in socioeconomic status affects a child's education journey as according to the article "[**Commentary: How can Singapore lessen the impact of SES on educational achievements?**](https://www.channelnewsasia.com/commentary/parents-children-education-socio-economic-status-2970186)**"** (ChannelNewsAsia, 29 Sept 2022), "parents with the financial means can provide resources such as tuition to enhance their children’s learning, and better provide them with a head-start in life."

This was supported by [PISA](https://gpseducation.oecd.org/CountryProfile?primaryCountry=SGP&treshold=10&topic=PI) (2022):

1.  Singapore has one of the **highest differences in mathematics performance** **between students in the top quarter and students in the bottom quarter of the economic, social and cultural status index (ESCS)**.

    1.  The difference in mathematics performance associated with a one-unit increase in the PISA index of economic, social and cultural status (ESCS) is one of the largest among PISA-participating countries and economies.

    2.  The difference in science performance associated with a one-unit increase in the PISA index of economic, social and cultural status (ESCS) is one of the largest among PISA-participating countries and economies.

::: {.callout-note collapse="true"}
## Expand To Learn More About The Effect of SES on academic performance

"Parents with the financial means can provide resources such as tuition to enhance their children’s learning, and better provide them with a head-start in life. Conversely, parents from the lower-income brackets tend to lack the resources to augment their children’s learning.

Without adequate guidance at home, children from less financially stable families are often ill-prepared for learning. As a result, pupils from more humble backgrounds are identified as weaker students as early as Primary 1.

Additionally, these students often do not have role models who can advise them on the pathways to educational success. This often affects their ability to make sound decisions, due to a lack of awareness of the implications that their choices may have on their future.

These early academic gaps widen when students from higher-income families continue to outperform and move on to schools that have more access to resources.

For instance, independent schools that cater to higher-achieving students will have resources that expose them to enrichment programmes and out-of-classroom learning activities.

When students from humbler families lag their higher SES classmates in academic performance, this can have larger implications on social mobility as well, as national exams determine the type of education these children will go on to receive, the future friends and connections they make, and their eventual jobs."
:::

### 1.2.3 ***Gender and academic performance***

Gender inequality seems to have changed in favour of girls over time - [Statistics Singapore](https://www.singstat.gov.sg/-/media/files/publications/population/ssn222-pg16-19.ashx) (2022) reported that "with more rapid improvement in educational attainment among females, the difference in mean years of schooling" has narrowed, with it becoming smaller for the younger age groups.

[![Taken from Statistics Singapore (2022)](images/clipboard-810889550.png){width="514"}](https://www.singstat.gov.sg/-/media/files/publications/population/ssn222-pg16-19.ashx)

[PISA](https://gpseducation.oecd.org/CountryProfile?primaryCountry=SGP&treshold=10&topic=PI) (2022) also found that:

1.  **Boys outperformed girls in mathematics by 12 score points; girls outperformed boys in reading by 20 score points** in Singapore.

    1.  The difference between girls and boys in science performance is one of the largest among PISA-participating countries and economies in favour of girls.

::: {.callout-note collapse="true"}
## Expand To Learn More About The Effect of Gender on academic performance

It was reported in a 2017 article "[**Girls lead in primary school but boys catch up: MOE study**](https://www.straitstimes.com/singapore/education/girls-lead-but-boys-catch-up)**"** (The Straits Times, 22 Jan 2017:

"Girls tend to outdo boys academically at a younger age although this gap closes as they enter their late teens and early 20s.

Statistics from the Ministry of Education (MOE) showed that in the last 10 years, girls performed "slightly better" than boys in the Primary School Leaving Examination. Girls were around 2 to 3 percentage points over-represented in the top quintile, and about 3 to 4 percentage points under-represented in the bottom quintile.

At the O levels, girls were around 1 to 2 percentage points over-represented in the top quintile and about 1 to 2 percentage points under-represented in the bottom quintile.

But there was hardly any distinction in qualification to the tertiary level. The numbers of males and females pursuing degrees in local universities have been comparable over the past three years, said the ministry.

For instance, out of a total of 18,126 undergraduates in the 2015 intake for the six publicly-funded universities, 9,192 were female."
:::
:::

# 2 Data

## 2.1 Data Sources

The [PISA 2022 database](https://www.oecd.org/pisa/data/2022database/) contains the full set of responses from individual students, school principals and parents. There are a total of five data files and their contents are as follows:

-   Student questionnaire data file

-   School questionnaire data file

-   Teacher questionnaire data file

-   Cognitive item data file

-   Questionnaire timing data file

In this exercise, only the Student questionnaire data file was used and uploaded as **stu_qqq_SG**.

## 2.2 Data Preparation and Cleaning

### 2.2.1 Installing R packages and loading the dataset

::: {.codebox .code data-latex="code"}
The code chunk below uses p_load() of pacman package to check if tidyverse, ggrepel, ggthemes, hrbrthemes, patchwork and haven packages are installed in the computer. If they are, then they will be launched into R.
:::

```{r}
pacman::p_load(ggrepel, patchwork, 
               ggthemes, hrbrthemes,
               tidyverse, kableExtra,
               haven, dplyr,
               ggdist, ggridges,
               colorspace) 
```

::: {.codebox .code data-latex="code"}
The code chunk below reads the .rds file containing data about students from Singapore.
:::

```{r}
stu_qqq_SG <-
  read_rds("data/stu_qqq_SG.rds")
```

### 2.2.2 Summary Statistic of **stu_qqq_SG**

::: panel-tabset
## Data Table

### Displaying the first 5 rows of **stu_qqq_SG** using `head():`

```{r}
head(stu_qqq_SG,5) %>%
  kbl() %>%
   kable_classic_2(full_width = F)
```

## Data Structure

### Checking the structure of **stu_qqq_SG** using `glimpse():`

::: {.focusbox .focus data-latex="focus"}
**Structure of stu_qqq_SG**

There are 6606 rows and 1279 variables.
:::

```{r}
glimpse(stu_qqq_SG)
```

## Data Health

### Checking for any symptoms of messy data:

::: {.focusbox .focus data-latex="focus"}
**Symptoms of messy data in stu_qqq_SG**

-   No duplicated rows
-   4168500 missing values
    -   234 variables with 0% missing values
    -   503 variables with 100% missing values
:::

#### 1. Checking for duplicates:

```{r}
stu_qqq_SG[duplicated(stu_qqq_SG),]
```

#### 2. Checking missing values:

```{r}
sum(is.na(stu_qqq_SG))

```

```{r}
missing_percentage <- colMeans(is.na(stu_qqq_SG)) * 100
result <- data.frame(Column = names(missing_percentage), MissingPercentage = missing_percentage)

num_100_percent_missing <- sum(result$MissingPercentage == 100)
num_0_percent_missing <- sum(result$MissingPercentage == 0)
cat("Number of columns with 0% missing values:", num_0_percent_missing, "\n")
cat("Number of columns with 100% missing values:", num_100_percent_missing, "\n")

```
:::

### 2.2.3 Some Identified Variables of Interest

Based on the [1.2 The Literature Review] above, these are some identified variables that we can use for our [1.1 The Task].

```{mermaid}
flowchart TB
  A[School]
  A1[Name of school]
  A2[School ICT resources]
  A3[Sense of belonging]
  A4[Quality of student-teacher relationships]
  A5[Teacher support]
  B[SES]
  B1[Perception of SES]
  B2[ICT resources]
  B3[Family support]
  B4[Participating in income-generating work]
  C[Gender]
  D[Reading Scores]
  E[Math Scores]
  F[Science Scores]
  
  D --> A
  D --> B
  D --> C
  E --> A
  E --> B
  E --> C
  F --> A
  F --> B
  F --> C
  A --> A1
  A --> A2
  A --> A3
  A --> A4
  A --> A5
  B --> B1
  B --> B2
  B --> B3
  B --> B4
```

#### 2.2.3.1 Investigating Plausible Values of MATH, READ, SCIENCE

According to the article "[Efficiency Analysis with Educational Data: How to Deal with Plausible Values from International Large-Scale Assessments](https://www.mdpi.com/2227-7390/9/13/1579)", it mentioned that analysts often used just **one of the plausible values** - "the standard errors of the statistics of interest are generally underestimated, as the uncertainty associated with the measurement of proficiency distributions is ignored. However, PISA analysts indicate that using one or five plausible values in a large sample **does not make a substantial difference**" (bold my own).

This section visually investigates if there is significant difference between the distribution of plausible values.

::: panel-tabset
## **Step 1: Filtering PVs**

::: {.codebox .code data-latex="code"}
The code chunk below filters out PV1MATH and the other 9 PVs, PV1READ and the other 9 PVs, PV1SCIE and the other 9 PVs into a new data frame.
:::

```{r}
pv_data <- stu_qqq_SG[, c("PV1MATH", "PV2MATH", "PV3MATH", "PV4MATH", "PV5MATH", "PV6MATH", "PV7MATH", "PV8MATH", "PV9MATH", "PV10MATH", "PV1READ", "PV2READ", "PV3READ", "PV4READ", "PV5READ", "PV6READ", "PV7READ", "PV8READ", "PV9READ", "PV10READ", "PV1SCIE", "PV2SCIE", "PV3SCIE", "PV4SCIE", "PV5SCIE", "PV6SCIE", "PV7SCIE", "PV8SCIE", "PV9SCIE", "PV10SCIE")]

glimpse(pv_data)
```

## **Step 2: Aggregating new variables**

::: {.codebox .code data-latex="code"}
The code chunk aggregates the different PV columns for Math, Reading and Science into key-value columns for each type of score using [`tidyverse::gather()`](https://tidyr.tidyverse.org/reference/gather.html).
:::

```{r}
#| warning: false
pv_data <- pv_data %>%
  gather(key = "SCIType", value = "SCIPV", 21:30) %>%
  gather(key = "MATHType", value = "MATHPV", 1:10) %>%
  gather(key = "READType", value = "READPV", 1:10)

pv_data$MATHType <- factor(pv_data$MATHType, levels = c("PV1MATH", "PV2MATH", "PV3MATH", "PV4MATH", "PV5MATH", "PV6MATH", "PV7MATH", "PV8MATH", "PV9MATH", "PV10MATH"))
pv_data$READType <- factor(pv_data$READType, levels = c("PV1READ", "PV2READ", "PV3READ", "PV4READ", "PV5READ", "PV6READ", "PV7READ", "PV8READ", "PV9READ", "PV10READ"))
pv_data$SCIType <- factor(pv_data$SCIType, levels = c("PV1SCIE", "PV2SCIE", "PV3SCIE", "PV4SCIE", "PV5SCIE", "PV6SCIE", "PV7SCIE", "PV8SCIE", "PV9SCIE", "PV10SCIE"))
glimpse(pv_data)
  
```
:::

#### 2.2.3.2 Visualising Plausible Values of MATH, READ, SCIENCE with Ridgeline plot

```{r , fig.width=12,}
demo_mathpv <- ggplot(pv_data, 
       aes(x = MATHPV, 
           y = MATHType,
           fill = 0.5 - abs(0.5-after_stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE, bandwidth = 6.37) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1, option = "D", alpha = 0.6) +
    guides(fill = "none")

demo_readpv <- ggplot(pv_data, 
       aes(x = READPV, 
           y = READType,
           fill = 0.5 - abs(0.5-after_stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE, bandwidth = 6.37) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1, option = "D", alpha = 0.6) +
    guides(fill = "none")

demo_scipv <- ggplot(pv_data, 
       aes(x = SCIPV, 
           y = SCIType,
           fill = 0.5 - abs(0.5-after_stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", 
                      calc_ecdf = TRUE, bandwidth = 6.37) +
  scale_fill_viridis_c(name = "Tail probability",
                       direction = -1, option = "D", alpha = 0.6) 

patchwork_score <- demo_mathpv + demo_readpv + demo_scipv  + 
  plot_annotation(
    title = "PVs across MATH, READ and SCIENCE are similar",
    theme = theme(plot.title = element_text(size = 22))  
  )
patchwork_score & theme_fivethirtyeight() 

```

::: {.focusbox .focus data-latex="focus"}
#### **Insights from Ridgeline plot of Plausible Values**

The 10 Plausible Values for MATH, READ and SCIENCE are very close in their distribution, with seemingly similar probabilities as mapped by `stat(ecdf)`. It is concluded that as what the article posits, we can proceed with 1 plausible value - PV1 has been selected.
:::

### 2.2.4 Data Preparation

For the purpose of this exercise, to tease out any relationship between academic performance in Math, Reading and Science and 1) School, 2) SES, and 3) Gender, I have decided to use the variables SchoolID for School, ESCS for SES and ST004D01T for Gender.

```{mermaid}
flowchart TB
  A[School]
  A1[SchoolID]
  B[SES]
  B1[ESCS]
  C[Gender]
  C1[Gender]
  D[Reading Scores]
  E[Math Scores]
  F[Science Scores]
  
  D --> A
  D --> B
  D --> C
  E --> A
  E --> B
  E --> C
  F --> A
  F --> B
  F --> C
  A --> A1
  B --> B1
  C --> C1
```

::: {.callout-note collapse="true"}
## Expand To Learn More About ESCS

From the [PISA 2022 Technical Report](https://www.oecd.org/pisa/data/pisa2022technicalreport/PISA-2022-Technical-Report-Ch-19-PISA-Scaling-Procedures-Construct-Validation-Context-Questionnaire-Data.pdf),

![](images/clipboard-2442450026.png){width="553"}
:::

::: {.codebox .code data-latex="code"}
The code chunk below filters out the identified variables of interest (CNTSTUID, CNTSCHID: Intl. School ID, ESCS: Index of economic, social and cultural status, ST004D01T: Gender, PV1MATH, PV1READ, and PV1SCIE) into a new data frame.
:::

```{r}
filtered_data <- stu_qqq_SG[, c("CNTSTUID", "CNTSCHID", "ESCS", "ST004D01T", "PV1MATH", "PV1READ", "PV1SCIE")]
```

::: {.codebox .code data-latex="code"}
The code chunk below writes the tbl_df into a new .rds file.
:::

```{r}
#| eval: false
write_rds(filtered_data,
          "data/filtered_data.rds")
```

::: {.codebox .code data-latex="code"}
The code chunk below reads the new .rds file that contains filtered data about students from Singapore.
:::

```{r}
filtered_data <-
  read_rds("data/filtered_data.rds")
```

#### 2.2.4.1 Summary Statistic of **filtered_data**

::: panel-tabset
## Data Table

### Displaying the first 5 rows of **filtered_data** using `head():`

```{r}
head(filtered_data,5) %>%
  kbl() %>%
   kable_classic_2(full_width = F)
```

## Data Structure

### Checking the structure of **filtered_data** using `glimpse():`

::: {.focusbox .focus data-latex="focus"}
#### Structure of filtered_data

There are 6606 rows and 7 variables.

Of note, CNTSTUID, CNTSCHID and ST004D01T have been wrongly labelled as \<`dbl>` when they should be cast as `<factor>` as they is categorical in nature.
:::

```{r}
glimpse(filtered_data)
```

## Data Health

### Checking for any symptoms of messy data:

::: {.focusbox .focus data-latex="focus"}
#### Symptoms of messy data in filtered_data

-   No duplicated rows
-   47 missing values
    -   6 variables with 0% missing values
    -   ESCS has 0.7% missing values
-   There are no data irregularities.
:::

#### 1. Checking for duplicates:

```{r}
filtered_data[duplicated(filtered_data),]
```

#### 2. Checking missing values:

```{r}
sum(is.na(filtered_data))

```

```{r}
missing_percentage <- colMeans(is.na(filtered_data)) * 100
result <- data.frame(Column = names(missing_percentage), MissingPercentage = missing_percentage)

num_100_percent_missing <- sum(result$MissingPercentage == 100)
num_0_percent_missing <- sum(result$MissingPercentage == 0)
cat("Number of columns with 0% missing values:", num_0_percent_missing, "\n")
cat("Number of columns with 100% missing values:", num_100_percent_missing, "\n")
print(result)
```

#### 3. Checking data irregularities:

3.1 In CNTSTUID

```{r}
unique(filtered_data$CNTSTUID)

```

3.2 In CNTSCHID

```{r}
unique(filtered_data$CNTSCHID)

```

3.3 In ESCS

```{r}
summary(filtered_data$ESCS)

```

3.4 In ST004D01T

```{r}
unique(filtered_data$ST004D01T)

```

3.5 In PV1MATH

```{r}
summary(filtered_data$PV1MATH)

```

3.6 In PV1READ

```{r}
summary(filtered_data$PV1READ)

```

3.7 In PV1SCIE

```{r}
summary(filtered_data$PV1SCIE)

```
:::

### 2.2.5 Altering table format of **filtered_data**

#### {{< fa circle-exclamation >}} **Data Quality Issues**:

-   `is.na()` revealed that there were 47 **missing values** in the data. These were removed using `dplyr::na.omit()` function
-   **CNTSTUID, CNTSCHID** and **ST004D01T** are classified as `<chr>`, but are categorical in nature. This is cast as factor type using `as.factor()`.
-   **ST004D01T**'s categories of 1 and 2 do not intuitively explain GENDER. They were renamed using `dplyr::mutate()` function. **CNTSCHID**'s IDs were too long, starting with 7020. They were removed using `dplyr::sub()` function.
-   The titles of **CNTSTUID, CNTSCHID**, **ST004D01T**, **PV1MATH**, **PV1READ** and **PV1SCIE** do not intuitively explain the variable. They were renamed using `dplyr::rename()` function.

::: panel-tabset
## **Step 1: Removing Missing values:**

```{r}
#| code-fold: show
# Removing Rows with NA Values in Any Column
filtered_data <- filtered_data %>%
  na.omit()
```

Checking for missing values:

```{r}
sum(is.na(filtered_data))
```

## **Step 2: Changing data types:**

```{r}
#| code-fold: show
# Casting category as factor
filtered_data$CNTSTUID <- as.factor(filtered_data$CNTSTUID)
filtered_data$CNTSCHID <- as.factor(filtered_data$CNTSCHID)
filtered_data$ST004D01T <- as.factor(filtered_data$ST004D01T)

```

## **Step 3: Changing variables' categories:**

```{r}
#| code-fold: show
# Renaming 1 and 2 to Female and Male
filtered_data <- filtered_data %>% 
    mutate(ST004D01T = str_replace(ST004D01T, "1", "Female"),
         ST004D01T = str_replace(ST004D01T, "2", "Male"))

# Removing 7020 from the front of CNTSCHID
filtered_data$CNTSCHID <- as.character(filtered_data$CNTSCHID) 
filtered_data$CNTSCHID <- sub("^7020", "", filtered_data$CNTSCHID)
filtered_data$CNTSCHID <- as.factor(filtered_data$CNTSCHID)
```

## **Step 4: Changing data names:**

```{r}
#| code-fold: show
# Renaming variables
filtered_data <- filtered_data %>% 
    rename("STUDENTID" = "CNTSTUID",
          "SCHOOLID" = "CNTSCHID",
           "SES" = "ESCS",
            "GENDER" = "ST004D01T",
           "MATH" = "PV1MATH",
           "READ" = "PV1READ",
           "SCIENCE" = "PV1SCIE"
             )
```
:::

### 2.2.6 Cleaned **filtered_data**

::: {.focusbox .focus data-latex="focus"}
#### Summary Statistics of filtered_data

-   There are 6559 students.
-   There are 164 schools.
-   There are only males and females.
:::

::: {.codebox .code data-latex="code"}
The code chunk below summarizes filtered_data.
:::

```{r}
glimpse(filtered_data)
```

```{r}
categorical_variables <- sapply(filtered_data, function(x) !is.numeric(x))
sapply(filtered_data[categorical_variables], function(x) length(unique(x)))
```

# 3 Visual Summary of filtered_data

## 3.1 Visualising Math, Reading, Science, Schools, SES and Gender

::: {.codebox .code data-latex="code"}
The code chunk below visualises the distribution of each variable scores using histograms and bar charts.
:::

```{r, fig.width= 10, fig.height = 10}
math <- ggplot(data=filtered_data, 
             aes(x = MATH)) +
  geom_histogram(bins=20, 
                 boundary = 100,
                 color="grey25", 
                 fill="grey90") +
  coord_cartesian(xlim=c(0,1000)) +
  ggtitle("Distribution of Math Scores")

read <- ggplot(data=filtered_data, 
             aes(x = READ)) +
  geom_histogram(bins=20, 
                 boundary = 100,
                 color="grey25", 
                 fill="grey90") + 
  coord_cartesian(xlim=c(0,1000)) +
  ggtitle("Distribution of Reading Scores")

sci <- ggplot(data=filtered_data, 
             aes(x = SCIENCE)) +
  geom_histogram(bins=20, 
                 boundary = 100,
                 color="grey25", 
                 fill="grey90") + 
  coord_cartesian(xlim=c(0,1000)) +
  ggtitle("Distribution of Science Scores")

ses <- ggplot(data=filtered_data, 
             aes(x = SES)) +
  geom_histogram(bins=20, 
                 boundary = 100,
                 color="grey25", 
                 fill="grey90") +
  coord_cartesian(xlim=c(-5,5)) +
  ggtitle("Distribution of SES")

gender <- ggplot(data=filtered_data, 
             aes(x = GENDER)) +
   geom_bar(color="grey25", fill="grey90") +
   coord_cartesian(xlim=c(0,3)) +
  ggtitle("Distribution of Gender")


patchwork <- ( math / read/ sci) | (ses / gender)
patchwork <- patchwork + 
  plot_annotation(
    title = "Right-skewed distributions for Math, Reading, Science and SES",
    theme = theme(plot.title = element_text(size = 50))  
  )
patchwork & theme_fivethirtyeight(base_size = 7)

```

## 3.2 Visualising Math, Reading and Science Scores with Schools, SES and Gender

::: {.thinkbox .think data-latex="think"}
#### Visual Considerations

-   The aim of these visualisations was to show the relation between the different types of scores, and schools, SES and Gender.

-   Trends in each plot were emphasized by:

    -   using `geom_vline` to visualise the mean,

    -   using `annotate` to identify and label the mean.

-   Plots were coded separately and put side-by-side to see the relationships between scores, schools, SES and gender by Math, Reading and Science using `patchwork`.

-   Insets of distributions of variables (schools, SES and gender) were attempted but due to `patchwork`, the resulting visualisations were too cluttered and thus, had its own section \[2.3.1 Visualising Math, Reading, Science, Schools, SES and Gender\].

-   Well-worded titles with a story were crafted.
:::

::: {.codebox .code data-latex="code"}
The code chunk below visualises the distribution of Math scores using histogram, ridgeline plot, scatterplot and raincloud plot.
:::

### 3.2.1 Visualising Math with Schools, SES and Gender

```{r, fig.width= 10, fig.height = 10}
#| warning: false
math <- ggplot(data=filtered_data, 
             aes(x = MATH)) +
  geom_histogram(bins=20, 
                 boundary = 100,
                 color="grey25", 
                 fill="grey90") +
  geom_vline(xintercept = 472, color = "#ecffa4", linetype = "dashed", size = 1.5) +
    geom_vline(aes(xintercept=mean(filtered_data$MATH)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1) +
    annotate("text", x = 472, y = 10, 
           label = "OECD Mean = 472",
           color = "grey25", size = 4,vjust = -66, hjust = 1.10) + 
  annotate("text", x = mean(filtered_data$MATH) + 20, y = 10, label = paste("Mean: ", round(mean(filtered_data$MATH), 0)),
           color = "grey25", size = 4, vjust = -66, hjust = -0.15) + 
  coord_cartesian(xlim=c(0,1000)) +
  ggtitle("Distribution of Math Scores")

# Calculate the mean math score for each school
school_means <- filtered_data %>%
  group_by(SCHOOLID) %>%
  summarize(MeanMathScore = mean(MATH, na.rm = TRUE), .groups = 'drop')

# Select the top 5 and bottom 5 schools
top_bottom_schools <- school_means %>%
  arrange(MeanMathScore) %>%
  slice(c(1:5, (n()-4):n())) %>%
  pull(SCHOOLID)

# Filter the original dataset to include only the selected schools
selected_school_data <- filtered_data %>%
  filter(SCHOOLID %in% top_bottom_schools)

# Set the SCHOOLID as a factor ordered by the mean scores
selected_school_data <- selected_school_data %>%
  mutate(SCHOOLID = factor(SCHOOLID, levels = top_bottom_schools))


math_sch <- ggplot(selected_school_data, aes(x = MATH, y = SCHOOLID, fill = after_stat(x))) +
  stat_density_ridges(
    geom = "density_ridges_gradient",
    calc_ecdf = TRUE, 
    quantiles = 4,
    quantile_lines = TRUE) +
  scale_fill_viridis_c(name = "Math Scores") +
  coord_cartesian(xlim=c(0,1000)) +
  theme_ridges() +
  labs(y = "School ID", x = "Math Scores", title = "Math Scores vs Top and Bottom 5 Schools") +
      geom_vline(aes(xintercept=mean(filtered_data$MATH)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1)


math_ses <- ggplot(filtered_data, aes(x = MATH, y = SES)) +
  geom_point() +
  geom_smooth(method = lm, size = 0.5, color = "blue") +
  geom_vline(aes(xintercept = mean(filtered_data$MATH)),
             color = "#f2aeae", 
             linetype = "dashed", 
             size = 1) +
  labs(x = "Math Scores", y = "SES", title = "Math Scores vs SES") +
  coord_cartesian(xlim = c(0, 1000), ylim = c(-5, 5))
   

math_gender <- ggplot(filtered_data, 
       aes(x = MATH, 
           y = GENDER)) +
  stat_halfeye(adjust = 0.5,
               justification = 0.1,
               .width = 0,
               point_colour = NA) +
  geom_boxplot(width = .15,
               outlier.shape = NA,
               position = position_nudge(x = 0.5)) + 
  coord_cartesian(xlim = c(0, 1000)) +
  geom_vline(aes(xintercept=mean(filtered_data$MATH)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1) +
  ggtitle("Math Scores vs Gender")


patchwork_math <- math | (math_sch / math_ses / math_gender) 
patchwork_math <- patchwork_math + 
  plot_annotation(
    title = "Singapore scores 103 points above OECD mean for Math",
    subtitle = "Some schools, higher SES and being male seem associated with higher Math scores",
    theme = theme(plot.title = element_text(size = 50))  
  )
patchwork_math & theme_fivethirtyeight(base_size = 7)

```

### 3.2.2 Visualising Reading Scores with Schools, SES and Gender

```{r, fig.width= 10, fig.height = 10}
#| warning: false
read <- ggplot(data=filtered_data, 
             aes(x = READ)) +
  geom_histogram(bins=20, 
                 boundary = 100,
                 color="grey25", 
                 fill="grey90") +
  geom_vline(xintercept = 472, color = "#ecffa4", linetype = "dashed", size = 1.5) +
    geom_vline(aes(xintercept=mean(filtered_data$READ)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1) +
    annotate("text", x = 476, y = 10, 
           label = "OECD Mean = 476",
           color = "grey25", size = 4,vjust = -66, hjust = 1) + 
  annotate("text", x = mean(filtered_data$READ) + 20, y = 10, label = paste("Mean: ", round(mean(filtered_data$READ), 0)),
           color = "grey25", size = 4, vjust = -66, hjust = -0.10) + 
  coord_cartesian(xlim=c(0,1000)) +
  ggtitle("Distribution of Reading Scores")

# Calculate the mean reading score for each school
school_means_read <- filtered_data %>%
  group_by(SCHOOLID) %>%
  summarize(MeanREADScore = mean(READ, na.rm = TRUE), .groups = 'drop')

# Select the top 5 and bottom 5 schools
top_bottom_schools_read <- school_means_read %>%
  arrange(MeanREADScore) %>%
  slice(c(1:5, (n()-4):n())) %>%
  pull(SCHOOLID)

# Filter the original dataset to include only the selected schools
selected_school_data_read <- filtered_data %>%
  filter(SCHOOLID %in% top_bottom_schools_read)

# Set the SCHOOLID as a factor ordered by the mean scores
selected_school_data_read <- selected_school_data_read %>%
  mutate(SCHOOLID = factor(SCHOOLID, levels = top_bottom_schools_read))


read_sch <- ggplot(selected_school_data_read, aes(x = READ, y = SCHOOLID, fill = after_stat(x))) +
  stat_density_ridges(
    geom = "density_ridges_gradient",
    calc_ecdf = TRUE, 
    quantiles = 4,
    quantile_lines = TRUE) +
  scale_fill_viridis_c(name = "Reading Scores") +
  theme_ridges() +
  labs(y = "School ID", x = "Reading Scores", title = "Reading Scores vs Top and Bottom 5 Schools") +
  geom_vline(aes(xintercept=mean(filtered_data$READ)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1)

read_ses <- ggplot(filtered_data, aes(x = READ, y = SES)) +
  geom_point() +
  geom_smooth(method = lm, size = 0.5, color = "blue") +
  geom_vline(aes(xintercept = mean(filtered_data$READ)),
             color = "#f2aeae", 
             linetype = "dashed", 
             size = 1) +
  labs(x = "Reading Scores", y = "SES", title = "Reading Scores vs SES") +
  coord_cartesian(xlim = c(0, 1000), ylim = c(-5, 5))
   

read_gender <- ggplot(filtered_data, 
       aes(x = READ, 
           y = GENDER)) +
  stat_halfeye(adjust = 0.5,
               justification = 0.1,
               .width = 0,
               point_colour = NA) +
  geom_boxplot(width = .15,
               outlier.shape = NA,
               position = position_nudge(x = 0.5)) + 
  coord_cartesian(xlim = c(0, 1000)) +
  geom_vline(aes(xintercept=mean(filtered_data$READ)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1) +
  ggtitle("Reading Scores vs Gender")


patchwork_read <- read | (read_sch / read_ses / read_gender) 
patchwork_read <- patchwork_read + 
  plot_annotation(
    title = "Singapore scores 69 points above OECD mean for Reading",
    subtitle = "Some schools, higher SES and being female seem associated with higher Reading scores",
    theme = theme(plot.title = element_text(size = 50))  
  )
patchwork_read & theme_fivethirtyeight(base_size = 7)

```

### 3.2.3 Visualising Science Scores with Schools, SES and Gender

```{r, fig.width= 10, fig.height = 10}
#| warning: false
sci <- ggplot(data=filtered_data, 
             aes(x = SCIENCE)) +
  geom_histogram(bins=20, 
                 boundary = 100,
                 color="grey25", 
                 fill="grey90") +
  geom_vline(xintercept = 472, color = "#ecffa4", linetype = "dashed", size = 1.5) +
    geom_vline(aes(xintercept=mean(filtered_data$SCIENCE)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1) +
    annotate("text", x = 485, y = 10, 
           label = "OECD Mean = 485",
           color = "grey25", size = 4,vjust = -66, hjust = 1.1) + 
  annotate("text", x = mean(filtered_data$SCIENCE) + 20, y = 10, label = paste("Mean: ", round(mean(filtered_data$SCIENCE), 0)),
           color = "grey25", size = 4, vjust = -66, hjust = -0.07) + 
  coord_cartesian(xlim=c(0,1000)) +
  ggtitle("Distribution of Science Scores")

# Calculate the mean reading score for each school
school_means_sci <- filtered_data %>%
  group_by(SCHOOLID) %>%
  summarize(MeanSCIENCEScore = mean(SCIENCE, na.rm = TRUE), .groups = 'drop')

# Select the top 5 and bottom 5 schools
top_bottom_schools_sci <- school_means_sci %>%
  arrange(MeanSCIENCEScore) %>%
  slice(c(1:5, (n()-4):n())) %>%
  pull(SCHOOLID)

# Filter the original dataset to include only the selected schools
selected_school_data_sci <- filtered_data %>%
  filter(SCHOOLID %in% top_bottom_schools_sci)

# Set the SCHOOLID as a factor ordered by the mean scores
selected_school_data_sci <- selected_school_data_sci %>%
  mutate(SCHOOLID = factor(SCHOOLID, levels = top_bottom_schools_sci))


sci_sch <- ggplot(selected_school_data_sci, aes(x = SCIENCE, y = SCHOOLID, fill = after_stat(x))) +
  stat_density_ridges(
    geom = "density_ridges_gradient",
    calc_ecdf = TRUE, 
    quantiles = 4,
    quantile_lines = TRUE) +
  scale_fill_viridis_c(name = "Science Scores") +
  theme_ridges() +
  labs(y = "School ID", x = "Science Scores", title = "Science Scores vs Top and Bottom 5 Schools") +
geom_vline(aes(xintercept=mean(filtered_data$SCIENCE)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1)

sci_ses <- ggplot(filtered_data, aes(x = SCIENCE, y = SES)) +
  geom_point() +
  geom_smooth(method = lm, size = 0.5, color = "blue") +
  geom_vline(aes(xintercept = mean(filtered_data$SCIENCE)),
             color = "#f2aeae", 
             linetype = "dashed", 
             size = 1) +
  labs(x = "Science Scores", y = "SES", title = "Science Scores vs SES") +
  coord_cartesian(xlim = c(0, 1000), ylim = c(-5, 5))
   

sci_gender <- ggplot(filtered_data, 
       aes(x = SCIENCE, 
           y = GENDER)) +
  stat_halfeye(adjust = 0.5,
               justification = 0.1,
               .width = 0,
               point_colour = NA) +
  geom_boxplot(width = .15,
               outlier.shape = NA,
               position = position_nudge(x = 0.5)) + 
  coord_cartesian(xlim = c(0, 1000)) +
  geom_vline(aes(xintercept=mean(filtered_data$SCIENCE)),
             color="#f2aeae", 
             linetype="dashed", 
             size=1) +
  ggtitle("Science Scores vs Gender")

patchwork_sci <- sci | (sci_sch / sci_ses / sci_gender) 
patchwork_sci <- patchwork_sci + 
  plot_annotation(
    title = "Singapore scores 77 points above OECD mean for Science",
    subtitle = "Some schools, higher SES and being male seem associated with higher Science scores",
    theme = theme(plot.title = element_text(size = 50))  
  )
patchwork_sci & theme_fivethirtyeight(base_size = 7)

```

::: {.focusbox .focus data-latex="focus"}
#### **Insights from Visualisations**

-   **Math and Schools, SES and Gender**

    -   There is a wide variation in the distribution of Math scores between the top 5 and bottom 5 schools. The top 5 schools are ahead of the mean and the bottom 5 schools are below. This suggests that certain schools are associated with higher Math scores.
    -   There appears to be an association between Math scores and SES with lower SES associated with lower Math Scores.
        -   The axes of the scatterplot are slightly weird and the choice of scatterplot might not be the most ideal.
    -   Male students tend to score higher on average than female students, with male students scoring higher than the mean score on average.

-   **Reading and Schools, SES and Gender**

    -   The distribution of Reading scores between the top 5 and bottom 5 schools is closer to the mean line. The top 5 schools are still ahead of the mean and the bottom 5 schools are below but the distribution of the bottom 5 schools appear to be more varied This suggests that certain schools are associated with higher Reading scores.

    -   There appears to be an association between Reading scores and SES with lower SES associated with lower Reading Scores.

        -   The axes of the scatterplot are slightly weird and the choice of scatterplot might not be the most ideal.

    -   Inversely, female students tend to score higher on average than male students, with female students scoring higher than the mean score on average.

-   **Science and Schools, SES and Gender**

    -   The top 5 schools are ahead of the mean and the bottom 5 schools are below the mean but closer to it. This suggests that certain schools are associated with higher Science scores.

    -   There appears to be an association between Science scores and SES with lower SES associated with lower Science Scores.

        -   The axes of the scatterplot are slightly weird and the choice of scatterplot might not be the most ideal.

    -   Male students tend to score higher on average than female students, although the gap is small.

        -   This visualisation contradicts the PISA finding that females scored higher than males (see \[1.2.3 Gender and academic performance\]). This requires more research into the data.
:::

# 4 Conclusion

## 4.1 Findings

In short, I can conclude that there are associations between academic scores of Math, Reading and Science, and the schools students attend, their socioeconomic status and gender. More research must be carried out to test if these hypotheses are statistically significant. Thus, even though every school is a "good" school, the literature review has argued that there are visible and hidden factors that influence a student's academic performance. These exploratory data visualisations suggest that there is grounds for more research.

## 4.2 Data Limitations

-   **Sampling bias:** The sample data appears to be skewed to the right for SES (gender seems arguably proportionate) and thus, we cannot accurately say that the data is representative of the entire Singapore 15 years old students population. Although not covered in this exercise and in PISA, race is a significant contributor to academic performance and the lack of information on it does not reveal if the sample is biased towards one racial group. Thus, we again cannot say if the sample data reflects the broader population.

-   **Incomplete measurements:** Even though we can see that some schools are associated with higher test scores, we are not sure what are the reasons for it. Due to the limitation of this exercise, only one variable was selected even though other variables of interest might explain why. Moreover, data from school/teachers questionnaires were not considered in this exercise, limiting the conclusions we can draw from it.

    -   Other areas of interest is the relationship between family and SES. The interplay of factors is interesting to study.

-   **No testing done:** Due to the limitation of this exercise, no hypothesis testing was carried out. While the data visualisations and data exploration have highlighted some associations, it is unclear if these factors directly impact academic scores. More research must be done to test these hypotheses.

## 4.3 A Visual Summary

```{mermaid}
flowchart TB
  A[School]
  A1[SchoolID]
  A11[70200003]
  A12[70200155]
  A13[70200001]
  B[SES]
  B1[ESCS]
  B11[Higher SES]
  C[Gender]
  C1[Gender]
  C11[Male]
  C12[Female]
  D[Reading Scores]
  E[Math Scores]
  F[Science Scores]
  
  D --> A
  D --> B
  D --> C
  E --> A
  E --> B
  E --> C
  F --> A
  F --> B
  F --> C
  A --> A1
  B --> B1
  C --> C1
  A1 --> A11
  A1 --> A12
  A1 --> A13
  B1 --> B11
  C1 --> C11
  C1 --> C12
```

::: callout-warning
This is not an exhaustive list - more school IDs have not been included but 70201003 is a school that appeared in the top 5 schools for Math, Reading and Science scores! With more research, this will become more comprehensive.
:::
